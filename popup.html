<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idealista Property Manager</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="popup-container">
        <header class="popup-header">
            <h1>🏠 Property Manager</h1>
            <div class="header-actions">
                <button id="debugBtn" class="btn btn-secondary">🐛 Debug</button>
                <button id="exportBtn" class="btn btn-secondary">📊 Exportar</button>
                <button id="clearBtn" class="btn btn-danger">🗑️ Limpiar</button>
            </div>
        </header>

        <div class="stats-bar">
            <span id="totalProperties">0 propiedades</span>
            <span id="avgScore" class="clickable-score">Score: 0</span>
            <span id="bestPrice">Mejor: 0€</span>
        </div>

        <div class="properties-container">
            <div id="propertiesList" class="properties-list">
                <!-- Properties will be inserted here -->
            </div>
        </div>

        <div id="emptyState" class="empty-state">
            <div class="empty-icon">🏠</div>
            <h3>No hay propiedades guardadas</h3>
            <p>Navega a una propiedad de Idealista y haz clic en "Agregar" para comenzar</p>
        </div>
    </div>

    <!-- Scoring Explanation Modal -->
    <div id="scoringModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📊 Cálculo del Score</h2>
                <span class="close" id="closeModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="scoring-overview">
                    <h3>Algoritmo de Puntuación Objetiva</h3>
                    <p>El score se calcula usando estadísticas del mercado inmobiliario español, con pesos basados en la importancia real de cada factor para el valor de una propiedad.</p>
                </div>
                
                <div class="scoring-breakdown">
                    <h4>Desglose por Categorías:</h4>
                    <div id="scoringDetails">
                        <!-- Scoring details will be populated here -->
                    </div>
                </div>

                <div class="scoring-stats">
                    <h4>📈 Estadísticas del Mercado (Madrid):</h4>
                    <ul>
                        <li><strong>Precio promedio:</strong> 750€/mes</li>
                        <li><strong>Precio por m²:</strong> 12€/m²</li>
                        <li><strong>Tamaño promedio:</strong> 65m²</li>
                        <li><strong>Habitaciones promedio:</strong> 2.5</li>
                    </ul>
                </div>

                <div class="scoring-weights">
                    <h4>⚖️ Distribución de Pesos (Basada en Análisis de Mercado):</h4>
                    <div class="weight-chart">
                        <div class="weight-item">
                            <span class="weight-label">Precio (30%)</span>
                            <div class="weight-bar">
                                <div class="weight-fill" style="width: 30%"></div>
                            </div>
                        </div>
                        <div class="weight-item">
                            <span class="weight-label">Tamaño (20%)</span>
                            <div class="weight-bar">
                                <div class="weight-fill" style="width: 20%"></div>
                            </div>
                        </div>
                        <div class="weight-item">
                            <span class="weight-label">Habitaciones (15%)</span>
                            <div class="weight-bar">
                                <div class="weight-fill" style="width: 15%"></div>
                            </div>
                        </div>
                        <div class="weight-item">
                            <span class="weight-label">Características (15%)</span>
                            <div class="weight-bar">
                                <div class="weight-fill" style="width: 15%"></div>
                            </div>
                        </div>
                        <div class="weight-item">
                            <span class="weight-label">Precio/m² (10%)</span>
                            <div class="weight-bar">
                                <div class="weight-fill" style="width: 10%"></div>
                            </div>
                        </div>
                        <div class="weight-item">
                            <span class="weight-label">Baños (10%)</span>
                            <div class="weight-bar">
                                <div class="weight-fill" style="width: 10%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="popup.js"></script>
</body>
</html>
